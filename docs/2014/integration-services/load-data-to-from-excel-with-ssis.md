---
title: SSIS を使用する Excel からのインポートまたは Excel へのエクスポート | Microsoft Docs
description: 前提条件、既知の問題、制限事項と共に、SQL Server Integration Services (SSIS) を使用して Excel データをインポートまたはエクスポートする方法について説明します。
ms.date: 04/10/2018
ms.prod: sql-server-2014
ms.prod_service: integration-services
ms.reviewer: ''
ms.custom: ''
ms.technology: integration-services
ms.topic: conceptual
author: janinezhang
ms.author: janinez
manager: craigg
ms.openlocfilehash: e2092ef7f755b9980ee29ee3d7080774d78a0094
ms.sourcegitcommit: 3026c22b7fba19059a769ea5f367c4f51efaf286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/15/2019
ms.locfileid: "62767314"
---
# <a name="import-data-from-excel-or-export-data-to-excel-with-sql-server-integration-services-ssis"></a>SQL Server Integration Services (SSIS) を使用して、Excel からデータをインポートする、または Excel にデータをエクスポートする

この記事では、SQL Server Integration Services (SSIS) を使用して、Excel からデータをインポートする、または Excel にデータをエクスポートする方法について説明します。 また、前提条件、制限事項、および既知の問題についても説明します。

Excel からデータをインポートする、または Excel にデータをエクスポートするには、SSIS パッケージを作成し、Excel 接続マネージャーと Excel ソースまたは Excel 変換先を使用することで行えます。 SSIS に組み込まれている SQL Server インポートおよびエクスポート ウィザードを使用することもできます。

この記事には、SSIS から Excel を正常に使用するため、または一般的な問題を理解して解決するために必要な 3 つの情報セットが含まれています。
1.  [必要なファイル](#files-you-need)。
2.  Excel から、または Excel へのデータの読み込み時に指定する必要がある情報。
    -   データ ソースとして [Excel を指定](#specify-excel)します。
    -   [Excel ファイル名とパス](#excel-file)を指定します。
    -   [Excel のバージョン](#excel-version)を選択します。
    -   [最初の行に列名が含まれる](#first-row)かどうかを指定します。
    -   [データを含むワークシートまたは範囲](#sheets-ranges)を指定します。
3.  既知の問題と制限事項。
    -   [データ型](#issues-types)に関する問題
    -   [インポート](#issues-importing)に関する問題。
    -   [エクスポート](#issues-exporting)に関する問題。

## <a name="files-you-need"></a> Excel に接続するために必要なファイルを取得する

Excel からデータをインポートしたり、データを Excel にエクスポートするには、事前に Excel の接続コンポーネントをダウンロードする必要があります (まだインストールされていない場合)。 Excel の接続コンポーネントは、既定ではインストールされません。

Excel の接続コンポーネントの最新版を [Microsoft Access データベース エンジン 2016 再頒布可能パッケージ](https://www.microsoft.com/download/details.aspx?id=54920)でダウンロードします。
  
以前のバージョンの Excel で作成したファイルは、最新バージョンのコンポーネントで開くことができます。

Microsoft Access 2016 *ランタイム*ではなく、必ず Access データベース エンジン 2016 *再頒布可能パッケージ*をダウンロードしてください。

32 ビット バージョンの Office を既にインストールしている場合は、32 ビット バージョンのコンポーネントをインストールする必要があります。 また、SSIS パッケージを 32 ビット モードで実行していること、またはインポートおよびエクスポート ウィザードの 32 ビット バージョンを実行していることを確認する必要があります。

Office 365 サブスクリプションをお持ちの場合は、インストーラーを実行するときにエラー メッセージが表示される場合があります。 このエラーは、ダウンロードを Office のクイック実行コンポーネントとサイド バイ サイドでインストールできないことを示します。 このエラー メッセージを回避するには、コマンド プロンプト ウィンドウを開き、`/quiet` スイッチを使用してダウンロードした .EXE ファイルを実行して、Quiet モードでインストールを実行します。 以下に例を示します。

`C:\Users\<user name>\Downloads\AccessDatabaseEngine.exe /quiet`

2016 再頒布可能パッケージのインストールに問題がある場合は、代わりに [Microsoft Access データベース エンジン 2010 再頒布可能パッケージ](https://www.microsoft.com/download/details.aspx?id=13255)から 2010 再頒布可能パッケージをインストールしてください。 (Excel 2013 用の再頒布可能パッケージはありません)。

## <a name="specify-excel"></a> Excel を指定する

最初の手順は、Excel に接続することを指定することです。

### <a name="in-ssis"></a>SSIS
SSIS で、Excel ソースまたは変換先ファイルに接続するための Excel 接続マネージャーを作成します。 接続マネージャーを作成するには、いくつかの方法があります。

-   **[接続マネージャー]** 領域内を右クリックし、 **[新しい接続]** を選択します。 **[SSIS 接続マネージャーの追加]** ダイアログ ボックスで **[EXCEL]** 、 **[追加]** の順に選択します。
 
-   **[SSIS]** メニューで **[新しい接続]** を選択します。 **[SSIS 接続マネージャーの追加]** ダイアログ ボックスで **[EXCEL]** 、 **[追加]** の順に選択します。

-   **Excel ソース エディター**または **Excel 変換先エディター**の **[接続マネージャー]** ページで、**Excel ソース**または **Excel 変換先**を構成するときに、同時に接続マネージャーを作成します。

### <a name="in-the-sql-server-import-and-export-wizard"></a>SQL Server インポートおよびエクスポート ウィザード
インポートおよびエクスポート ウィザードの **[データ ソースの選択]** または **[変換先の選択]** ページで、 **[データ ソース]** リストから **[Microsoft Excel]** を選択します。

データ ソースのリストに Excel が表示されない場合は、32 ビットのウィザードを実行していることを確認してください。 Excel 接続コンポーネントは、通常、32 ビット ファイルで、64 ビットのウィザードでは表示されません。

## <a name="excel-file"></a> Excel ファイルとファイル パス

最初に指定する情報は、Excel ファイルのパスとファイル名です。 この情報は、SSIS パッケージの **Excel 接続マネージャー エディター**、またはインポートとエクスポート ウィザードの **[データ ソースの選択]** または **[変換先の選択]** のページで指定します。

次の形式でパスとファイル名を入力します。

-   ローカル コンピューター上のファイルの場合、**C:\\TestData.xlsx** です。

-   ネットワーク共有上のファイルの場合、 **\\\\Sales\\Data\\TestData.xlsx** です。

または、 **[参照]** をクリックして、 **[ファイルを開く]** ダイアログ ボックスを使用してワークシートを検索します。  
  
> [!IMPORTANT]
> パスワードで保護された Excel ファイルには接続できません。

## <a name="excel-version"></a> Excel バージョン

2 番目に指定する情報は、Excel ファイルのバージョンです。 この情報は、SSIS パッケージの **Excel 接続マネージャー エディター**、またはインポートとエクスポート ウィザードの **[データ ソースの選択]** または **[変換先の選択]** のページで指定します。

ファイルを作成するために使用した Microsoft Excel のバージョンか、別の互換性のあるバージョンを指定します。 たとえば、2016 接続コンポーネントのインストールに問題がある場合、2010 コンポーネントをインストールして、このリストで **[Microsoft Excel 2007-2010]** を選択できます。

古いバージョンの接続コンポーネントしかインストールされていない場合は、それより新しいバージョンの Excel をリストで選択することはできません。 **Excel バージョン** リストには、SSIS によってサポートされている Excel のすべてのバージョンが含まれています。 このリスト内に項目があっても、必要な接続コンポーネントがインストールされているとは限りません。 たとえば、2016 接続コンポーネントをインストールしていなくても、リストには **Microsoft Excel 2016** が表示されます。

## <a name="first-row"></a> 先頭行に列名を含める

Excel からデータをインポートしている場合、次の手順は、データの最初の行に列の名前が含まれているかどうかを示すことです。 この情報は、SSIS パッケージの **Excel 接続マネージャー エディター**、またはインポートとエクスポート ウィザードの **[データ ソースの選択]** ページで指定します。

-   ソース データに列名が含まれていないため、このオプションを無効にすると、ウィザードでは F1、F2 などが列見出しとして使用されます。
-   データに列名が含まれているのにこのオプションを無効にすると、ウィザードでは列名がデータの最初の行としてインポートされます。
-   データに列名が含まれていないのにこのオプションを有効にすると、ウィザードではソース データの最初の行が列名として使用されます。 この場合、ソース データの最初の行は、データ自体には含まれなくなります。

Excel からデータをエクスポートする場合にこのオプションを有効にすると、エクスポートされたデータの最初の行に列名が含まれます。

## <a name="sheets-ranges"></a> ワークシートと範囲

データのソースまたは変換先として使用できる Excel オブジェクトには、ワークシート、名前付き範囲、またはそのアドレスを使って指定する名前のない範囲のセルの 3 種類があります。

-   **ワークシート。** ワークシートを指定するには、シート名の末尾に `$` 文字を付加し、文字列を区切り文字で囲みます (例: **[Sheet1$]** )。 または、リスト内の既存のテーブルとビューから `$` 文字で終わる名前を探します。

-   **名前付き範囲。** 名前付き範囲を指定するには、範囲名を指定します (例: **MyDataRange**)。 または、リスト内の既存のテーブルとビューから `$` 以外の文字で終わる名前を探します。
    
-   **名前のない範囲。** 名前のないセルの範囲を指定するには、シート名の末尾に $ 文字を付加し、範囲の指定を追加し、文字列を区切り文字で囲みます (例: **[Sheet1$A1:B4]** )。

データのソースまたは変換先として使用する Excel オブジェクトの種類を選択または指定するには、次のいずれかの操作を行います。

### <a name="in-ssis"></a>SSIS

SSIS で、**Excel ソース エディター**または **Excel 変換先エディター**の **[接続マネージャー]** ページで、次のいずれかの操作を行います。

-   **ワークシート**または**名前付き範囲**を使用するには、 **[データ アクセス モード]** に **[テーブルまたはビュー]** を選択します。 次に、 **[Excel シートの名前]** リストで、ワークシートまたは名前付き範囲を選択します。

-   そのアドレスを使用して指定する**名前のない範囲**を使用するには、 **[データ アクセス モード]** に **[SQL コマンド]** を選択します。 次に、 **[SQL コマンド テキスト]** フィールドに、次の例のようなクエリを入力します。

    ```sql
    SELECT * FROM [Sheet1$A1:B5]
    ```

### <a name="in-the-sql-server-import-and-export-wizard"></a>SQL Server インポートおよびエクスポート ウィザード
インポートおよびエクスポート ウィザードで、次のいずれかの操作を行います。

-   Excel から**インポートする**場合は、次のいずれかの操作を行います。

    -   **ワークシート**または**名前付き範囲**を使用するには、 **[テーブルのコピーまたはクエリの指定]** ページで、 **[1 つ以上のテーブルまたはビューからデータをコピーする]** を選択します。 次に、 **[コピー元のテーブルおよびビューを選択]** ページの **[ソース]** 列で、ソースのワークシートと名前付き範囲を選択します。

    -   そのアドレスを使用して指定する**名前のない範囲**を使用するには、 **[テーブルのコピーまたはクエリの指定]** ページで、 **[転送するデータを指定するためのクエリを記述する]** を選択します。 次に、 **[基になるクエリの指定]** ページで、次の例のようなクエリを指定します。

        ```sql
        SELECT * FROM [Sheet1$A1:B5]
        ```

-   Excel に**エクスポートする**場合は、次のいずれかの操作を行います。

    -   **ワークシート**または**名前付き範囲**を使用するには、 **[コピー元のテーブルおよびビューを選択]** ページの **[変換先]** 列で、エクスポート先のワークシートおよび名前付き範囲を選択します。

    -   そのアドレスを使用して指定する**名前のない範囲**を使用するには、 **[コピー元のテーブルおよびビューを選択]** ページの **[変換先]** 列で、区切り記号は使わずに、`Sheet1$A1:B5` の形式で範囲を入力します。 区切り記号はウィザードによって追加されます。

インポートまたはエクスポートする Excel オブジェクトを選択または入力すると、ウィザードの **[コピー元のテーブルおよびビューを選択]** ページで次の操作も行えるようになります。

-   **[マッピングの編集]** を選択して、変換元と変換先の間の列マッピングを確認する。

-   **[プレビュー]** を選択して、サンプル データが期待どおりになっていることをプレビューで確認する。

## <a name="issues-types"></a> データ型に関する問題

### <a name="data-types"></a>データ型

Excel ドライバーでは、データ型の限定されたセットのみを認識します。 たとえば、すべての数値列は倍精度浮動小数点型 (DT_R8) として解釈され、すべての文字列の列 (メモ列以外) は 255 文字の Unicode 文字列 (DT_WSTR) として解釈されます。 SSIS では、Excel データ型を次のようにマップします。

-   Numeric - 倍精度浮動小数点数 (DT_R8)

-   Currency - 通貨 (DT_CY)

-   Boolean - ブール (DT_BOOL)

-   Date/time - 日時 (DT_DATE)

-   String - Unicode 文字列、長さ 255 (DT_WSTR)

-   Memo - Unicode テキスト ストリーム (DT_NTEXT)

### <a name="data-type-and-length-conversions"></a>データ型と長さの変換

SSIS では、データ型の暗黙的な変換は行われません。 したがって、派生列変換またはデータ変換の変換を使用して、Excel データを明示的に変換してから Excel 以外の変換先に読み込むか、Excel 以外のソースからデータを変換してから Excel 変換先に読み込む必要があります。

必要な変換の例を次に示します。  
  
-   特定のコードページを使用した Unicode Excel 文字列の列と Unicode 以外の文字列の列間の変換
  
-   255 文字の Excel 文字列の列と異なる長さの文字列の列間の変換
  
-   倍精度の Excel 数値列と他の型の数値列の列間の変換

> [!TIP]
> インポートおよびエクスポート ウィザードを使用していて、データにこれらの変換がいくつか必要な場合は、ウィザードによって必要な変換が構成されます。 そのため、SSIS パッケージを使用する場合でも、インポートおよびエクスポート ウィザードを使用して初期パッケージを作成しておくと役立つ場合があります。 ウィザードを使用すると、接続マネージャー、ソース、変換、および変換先を作成および構成できます。

## <a name="issues-importing"></a> インポートに関する問題

### <a name="empty-rows"></a>空の行

ソースとしてワークシートまたは名前付き範囲を指定すると、ドライバーは、ワークシートまたは範囲の左上の空でない最初のセルから、*連続した*セルのブロックを読み取ります。 そのため、データ行は行 1 で開始する必要はありませんが、ソース データで空の行を使用することはできません。 たとえば、列ヘッダーとデータ行の間に空の行を入れたり、ワークシートの上部のタイトルの後に空の行を入れることはできません。

データの上に空の行がある場合は、ワークシートとしてデータにクエリを実行できません。 Excel では、データの範囲を選択し、その範囲に名前を割り当ててから、ワークシートではなく名前付き範囲に対してクエリを実行する必要があります。

### <a name="missing-values"></a>不足している値

Excel ドライバーは、指定した変換元の特定の行数 (既定では 8 行) を読み取り、各列のデータ型を推測します。 1 つの列に複数のデータ型が混在している可能性がある場合、特に数値データとテキスト データが混合している場合に、Excel ドライバーは数が多い方のデータ型を優先して判定し、それ以外のデータ型のデータが含まれるセルについては NULL 値を返します (同数の場合は、数値型が優先されます)。Excel ワークシートでのセル書式のほとんどのオプションは、このデータ型の判定に影響しません。

Excel ドライバーのこの動作を変更するには、すべての値をテキストとしてインポートするようにインポート モードを指定します。 インポート モードを指定するには、[プロパティ] ウィンドウで、Excel 接続マネージャーの接続文字列内の**拡張プロパティ**の値に `IMEX=1` を追加します。 

### <a name="truncated-text"></a>切り捨てられたテキスト

Excel の列にテキスト データが含まているとドライバーが判定した場合、ドライバーはサンプリングした最も長い値に基づいて、データ型 (文字列またはメモ) を選択します。 ドライバーがサンプリングした行で 255 文字より長い値が検出されなかった場合、その列はメモ列ではなく、255 文字の文字列の列として扱われます。 このため、255 文字より長い値があると、切り捨てられる場合があります。

データを切り捨てずにメモ列からインポートするには、2 つのオプションがあります。

-   サンプリングされた行の少なくとも 1 つのメモ列に、255 文字より長い値が含まれていることを確認します。

-   このような行を含めるには、ドライバーによってサンプリングされる行数を増やします。 サンプリングする行数を増やすには、次のレジストリ キーの下で **TypeGuessRows** の値を増やします。

| 再配布可能なコンポーネントのバージョン | レジストリ キー |
|---|---|
| Excel 2016 | HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Office\16.0\Access Connectivity Engine\Engines\Excel |
| Excel 2010 | HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Office\14.0\Access Connectivity Engine\Engines\Excel |
| | |

## <a name="issues-exporting"></a> エクスポートに関する問題

### <a name="create-a-new-destination-file"></a>新しいエクスポート先ファイルを作成する

#### <a name="in-ssis"></a>SSIS

作成する新しい Excel ファイルのパスとファイル名を使用して、Excel 接続マネージャーを作成します。 次に、**Excel 変換先エディター**で、 **[Excel シートの名前]** に **[新規]** を選択して、エクスポート先のワークシートを作成します。 この時点で、SSIS によって指定したワークシートを持つ新しい Excel ファイルが作成されます。

#### <a name="in-the-sql-server-import-and-export-wizard"></a>SQL Server インポートおよびエクスポート ウィザード

**[変換先の選択]** ページで、 **[参照]** を選択します。 **[ファイルを開く]** ダイアログ ボックスで、新しい Excel ファイルを作成するフォルダーに移動し、新しいファイルの名前を指定してから、 **[開く]** を選択します。

### <a name="export-to-a-large-enough-range"></a>十分な大きさの範囲をエクスポートする

変換先として範囲を指定するときに、範囲の "*列数*" がソース データより少ないと、エラーが発生します。 一方、指定した範囲がソース データより "*行数*" が少ない場合、エラーは発生せず、ウィザードでは行の記述が続行され、新しい行数に合わせて行の定義が拡張されます。

### <a name="export-long-text-values"></a>長いテキストの値をエクスポートする

255 文字を超える文字列を Excel 列に正常に保存するには、変換先の列のデータ型を **文字列型** ではなく **メモ型**としてドライバーが認識する必要があります。

-   既存の変換先のテーブルに既にデータ行が含まれている場合、ドライバーによってサンプリングされた先頭の数行のメモ列に、255 文字を超える値のインスタンスが 1 つ以上含まれている必要があります。

-   新しい変換先のテーブルがパッケージの設計時または実行時に作成される場合、またはインポートおよびエクスポート ウィザードによって作成される場合は、`CREATE TABLE` ステートメントで LONGTEXT (またはそのいずれかのシノニム) を変換先のメモ列のデータ型として使用する必要があります。 ウィザードで、 **[列マッピング]** ページの **[変換先テーブルの作成]** オプションの横にある **[SQL の編集]** をクリックし、`CREATE TABLE` ステートメントを調べて、必要であれば修正します。

## <a name="related-content"></a>関連コンテンツ

この記事で説明した手順とコンポーネントに関する詳細は、次の記事を参照してください。

### <a name="about-ssis"></a>SSIS について
[Excel 接続マネージャー](connection-manager/excel-connection-manager.md)  
[Excel ソース](data-flow/excel-source.md)  
[Excel 変換先](data-flow/excel-destination.md)  
[Foreach ループ コンテナーを使用して Excel のファイルおよびテーブルをループ処理する](control-flow/loop-through-excel-files-and-tables-by-using-a-foreach-loop-container.md)  
[スクリプト タスクを使用した Excel ファイルの操作](extending-packages-scripting-task-examples/working-with-excel-files-with-the-script-task.md)

### <a name="about-the-sql-server-import-and-export-wizard"></a>SQL Server インポートおよびエクスポート ウィザードについて
[Excel データ ソースに接続する](/sql/integration-services/import-export-data/connect-to-an-excel-data-source-sql-server-import-and-export-wizard)  
[簡単な例によるインポートおよびエクスポート ウィザードの概要](/sql/integration-services/import-export-data/get-started-with-this-simple-example-of-the-import-and-export-wizard)

### <a name="other-articles"></a>その他の記事
[Excel から SQL Server または Azure SQL Database にデータをインポートする](/sql/relational-databases/import-export/import-data-from-excel-to-sql)  

