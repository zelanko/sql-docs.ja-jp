---
title: キーセットドリブンカーソル |Microsoft Docs
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- keyset-driven cursors [ODBC]
- cursors [ODBC], key-set driven
ms.assetid: 01769f43-1d9c-4685-84fa-15a6465335e9
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 814fca7d48f50aab51b6b4f7e34835be8c412e9c
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/27/2020
ms.locfileid: "81306207"
---
# <a name="keyset-driven-cursors"></a>キーセット ドリブン カーソル
キーセットドリブンカーソルは、静的カーソルと動的カーソルの間に変更を検出する機能があります。 静的カーソルと同様に、結果セットのメンバーシップと順序に対する変更は常に検出されません。 動的カーソルと同様に、結果セット内の行の値に対する変更を検出します (SQL_ATTR_TXN_ISOLATION 接続属性によって設定された、トランザクションの分離レベルに従います)。  
  
 キーセットドリブンカーソルが開かれると、結果セット全体のキーが保存されます。これにより、結果セットの明確なメンバーシップと順序が修正されます。 カーソルが結果セットをスクロールすると、このキー*セット*内のキーを使用して各行の現在のデータ値が取得されます。 たとえば、キーセットドリブンカーソルによって行がフェッチされ、別のアプリケーションがその行を更新したとします。 カーソルが行を refetches している場合は、そのキーを使用して行がエッチングされるので、新しい値が表示されます。 このため、キーセットドリブンカーソルは、自身および他のユーザーによって行われた変更を常に検出します。  
  
 カーソルが削除された行を取得しようとすると、この行は結果セットに "パンチ穴" として表示されます。行のキーはキーセットに存在しますが、結果セットには存在しなくなります。 行のキー値が更新された場合、その行は削除されてから挿入されたと見なされます。そのため、このような行も結果セットに穴として表示されます。 キーセットドリブンカーソルは、他のユーザーが削除した行を常に検出できますが、必要に応じて、キーセットから削除される行のキーを削除することもできます。 これを行うキーセットドリブンカーソルでは、独自の削除を検出することはできません。 特定のキーセットドリブンカーソルが独自の削除を検出するかどうかは、 **SQLGetInfo**の SQL_STATIC_SENSITIVITY オプションを使用して報告されます。  
  
 キーセットにはこれらの行のキーが存在しないため、他のユーザーによって挿入された行がキーセットドリブンカーソルに表示されることはありません。 ただし、キーセットドリブンカーソルは、キーセットに挿入する行のキーを必要に応じて追加できます。 キーセットドリブンカーソルを使用すると、独自の挿入を検出できます。 特定のキーセットドリブンカーソルが独自の挿入を検出するかどうかは、 **SQLGetInfo**の SQL_STATIC_SENSITIVITY オプションを使用して報告されます。  
  
 SQL_ATTR_ROW_STATUS_PTR statement 属性によって指定された行の状態の配列には、任意の行の SQL_ROW_SUCCESS、SQL_ROW_SUCCESS_WITH_INFO、または SQL_ROW_ERROR を含めることができます。 このメソッドは、更新、削除、または挿入として検出された行の SQL_ROW_UPDATED、SQL_ROW_DELETED、または SQL_ROW_ADDED を返します。  
  
 キーセットドリブンカーソルは、通常、結果セット内の各行のキーを格納する一時テーブルを作成することによって実装されます。 カーソルは行が更新されているかどうかも判断する必要があるため、このテーブルには通常、行のバージョン管理情報を含む列が含まれています。  
  
 元の結果セットをスクロールするために、キーセットドリブンカーソルは、一時テーブルの上に静的カーソルを開きます。 元の結果セットの行を取得するために、カーソルはまず一時テーブルから適切なキーを取得し、次にその行の現在の値を取得します。 ブロックカーソルが使用されている場合、カーソルは複数のキーと行を取得する必要があります。
